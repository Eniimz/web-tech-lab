<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App - beDECOR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    body {
      background-color: #f8f9fa;
      padding: 2rem 0;
    }
    .crud-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .page-header {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .form-section {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .list-section {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .post-card {
      border: 1px solid #dee2e6;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
    }
    .post-card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }
    .post-id {
      color: #6c757d;
      font-size: 0.875rem;
      font-weight: 600;
    }
    .post-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0.5rem 0;
      color: #212529;
    }
    .post-body {
      color: #495057;
      margin-bottom: 1rem;
    }
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 2rem;
    }
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1055;
    }
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="crud-container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="mb-0">
            <i class="fas fa-database me-2"></i>CRUD Application
          </h1>
          <p class="text-muted mb-0 mt-2">Manage posts using JSONPlaceholder API</p>
        </div>
        <a href="/" class="btn btn-outline-primary">
          <i class="fas fa-home me-2"></i>Back to Home
        </a>
      </div>
    </div>

    <!-- Toast Container for Notifications -->
    <div class="toast-container">
      <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <i class="fas fa-info-circle me-2" id="toastIcon"></i>
          <strong class="me-auto" id="toastTitle">Notification</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
      </div>
    </div>

    <div class="row">
      <!-- Left Column: Form -->
      <div class="col-12 col-lg-4">
        <div class="form-section">
          <h3 class="mb-4">
            <i class="fas fa-edit me-2"></i>
            <span id="formTitle">Create New Post</span>
          </h3>
          <form id="postForm">
            <input type="hidden" id="postId" name="id">
            
            <div class="mb-3">
              <label for="postTitle" class="form-label">Title *</label>
              <input type="text" class="form-control" id="postTitle" name="title" required placeholder="Enter post title">
            </div>
            
            <div class="mb-3">
              <label for="postBody" class="form-label">Body *</label>
              <textarea class="form-control" id="postBody" name="body" rows="5" required placeholder="Enter post content"></textarea>
            </div>
            
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary" id="submitBtn">
                <i class="fas fa-save me-2"></i>Create Post
              </button>
              <button type="button" class="btn btn-secondary" id="cancelBtn" style="display: none;" onclick="resetForm()">
                <i class="fas fa-times me-2"></i>Cancel
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Right Column: List -->
      <div class="col-12 col-lg-8">
        <div class="list-section">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="mb-0">
              <i class="fas fa-list me-2"></i>Posts List
            </h3>
            <button class="btn btn-outline-primary" onclick="loadPosts()">
              <i class="fas fa-sync-alt me-2"></i>Refresh
            </button>
          </div>

          <!-- Loading Spinner -->
          <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading posts...</p>
          </div>

          <!-- Posts Container -->
          <div id="postsContainer">
            <!-- Posts will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script>
    const API_BASE_URL = 'https://jsonplaceholder.typicode.com/posts';
    let editingPostId = null;

    // Initialize
    $(document).ready(function() {
      loadPosts();
      setupFormSubmit();
    });

    // Load all posts
    function loadPosts() {
      showLoading(true);
      $('#postsContainer').empty();

      $.ajax({
        url: API_BASE_URL,
        method: 'GET',
        dataType: 'json',
        success: function(posts) {
          showLoading(false);
          if (posts.length === 0) {
            showEmptyState();
          } else {
            // Show only first 10 posts to keep it manageable
            const postsToShow = posts.slice(0, 10);
            postsToShow.forEach(post => {
              renderPost(post);
            });
          }
        },
        error: function(xhr, status, error) {
          showLoading(false);
          showToast('error', 'Error', 'Failed to load posts: ' + error);
          showEmptyState();
        }
      });
    }

    // Render a single post
    function renderPost(post) {
      const postHtml = `
        <div class="post-card" id="post-${post.id}">
          <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
              <div class="post-id">Post #${post.id}</div>
              <div class="post-title">${escapeHtml(post.title)}</div>
              <div class="post-body">${escapeHtml(post.body)}</div>
            </div>
            <div class="ms-3">
              <button class="btn btn-sm btn-outline-primary me-2" onclick="editPost(${post.id})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deletePost(${post.id}, '${escapeHtml(post.title)}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </div>
          </div>
        </div>
      `;
      $('#postsContainer').append(postHtml);
    }

    // Setup form submission
    function setupFormSubmit() {
      $('#postForm').on('submit', function(e) {
        e.preventDefault();
        
        const title = $('#postTitle').val().trim();
        const body = $('#postBody').val().trim();
        
        if (!title || !body) {
          showToast('error', 'Validation Error', 'Please fill in all required fields');
          return;
        }

        const postData = {
          title: title,
          body: body,
          userId: 1
        };

        if (editingPostId) {
          updatePost(editingPostId, postData);
        } else {
          createPost(postData);
        }
      });
    }

    // Create a new post
    function createPost(postData) {
      showLoading(true);
      
      $.ajax({
        url: API_BASE_URL,
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(postData),
        dataType: 'json',
        success: function(newPost) {
          showLoading(false);
          // Note: JSONPlaceholder doesn't actually save, so we'll add it with a temporary ID
          newPost.id = Date.now(); // Temporary ID for demo
          renderPost(newPost);
          resetForm();
          showToast('success', 'Success', 'Post created successfully!');
        },
        error: function(xhr, status, error) {
          showLoading(false);
          showToast('error', 'Error', 'Failed to create post: ' + error);
        }
      });
    }

    // Edit a post
    function editPost(id) {
      showLoading(true);
      
      $.ajax({
        url: `${API_BASE_URL}/${id}`,
        method: 'GET',
        dataType: 'json',
        success: function(post) {
          showLoading(false);
          editingPostId = post.id;
          $('#postId').val(post.id);
          $('#postTitle').val(post.title);
          $('#postBody').val(post.body);
          $('#formTitle').text('Edit Post');
          $('#submitBtn').html('<i class="fas fa-save me-2"></i>Update Post');
          $('#cancelBtn').show();
          // Scroll to form
          $('html, body').animate({
            scrollTop: $('.form-section').offset().top - 20
          }, 500);
        },
        error: function(xhr, status, error) {
          showLoading(false);
          showToast('error', 'Error', 'Failed to load post: ' + error);
        }
      });
    }

    // Update a post
    function updatePost(id, postData) {
      showLoading(true);
      
      $.ajax({
        url: `${API_BASE_URL}/${id}`,
        method: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify({ ...postData, id: id }),
        dataType: 'json',
        success: function(updatedPost) {
          showLoading(false);
          // Update the post in the list
          $(`#post-${id}`).replaceWith(renderPostHtml(updatedPost));
          resetForm();
          showToast('success', 'Success', 'Post updated successfully!');
        },
        error: function(xhr, status, error) {
          showLoading(false);
          showToast('error', 'Error', 'Failed to update post: ' + error);
        }
      });
    }

    // Delete a post
    function deletePost(id, title) {
      if (!confirm(`Are you sure you want to delete this post?\n\n"${title}"`)) {
        return;
      }

      showLoading(true);
      
      $.ajax({
        url: `${API_BASE_URL}/${id}`,
        method: 'DELETE',
        success: function() {
          showLoading(false);
          $(`#post-${id}`).fadeOut(300, function() {
            $(this).remove();
            if ($('#postsContainer').children().length === 0) {
              showEmptyState();
            }
          });
          showToast('success', 'Success', 'Post deleted successfully!');
        },
        error: function(xhr, status, error) {
          showLoading(false);
          showToast('error', 'Error', 'Failed to delete post: ' + error);
        }
      });
    }

    // Reset form
    function resetForm() {
      editingPostId = null;
      $('#postForm')[0].reset();
      $('#postId').val('');
      $('#formTitle').text('Create New Post');
      $('#submitBtn').html('<i class="fas fa-save me-2"></i>Create Post');
      $('#cancelBtn').hide();
    }

    // Render post HTML (helper function)
    function renderPostHtml(post) {
      return `
        <div class="post-card" id="post-${post.id}">
          <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
              <div class="post-id">Post #${post.id}</div>
              <div class="post-title">${escapeHtml(post.title)}</div>
              <div class="post-body">${escapeHtml(post.body)}</div>
            </div>
            <div class="ms-3">
              <button class="btn btn-sm btn-outline-primary me-2" onclick="editPost(${post.id})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deletePost(${post.id}, '${escapeHtml(post.title)}')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Show empty state
    function showEmptyState() {
      $('#postsContainer').html(`
        <div class="empty-state">
          <i class="fas fa-inbox"></i>
          <h4>No posts found</h4>
          <p>Create your first post using the form on the left!</p>
        </div>
      `);
    }

    // Show/hide loading spinner
    function showLoading(show) {
      if (show) {
        $('#loadingSpinner').show();
        $('#postsContainer').hide();
      } else {
        $('#loadingSpinner').hide();
        $('#postsContainer').show();
      }
    }

    // Show toast notification
    function showToast(type, title, message) {
      const toast = $('#toast');
      const toastIcon = $('#toastIcon');
      const toastTitle = $('#toastTitle');
      const toastMessage = $('#toastMessage');
      
      // Set icon and color based on type
      if (type === 'success') {
        toastIcon.removeClass().addClass('fas fa-check-circle me-2 text-success');
        toast.removeClass('text-bg-danger text-bg-warning').addClass('text-bg-success');
      } else if (type === 'error') {
        toastIcon.removeClass().addClass('fas fa-exclamation-circle me-2 text-danger');
        toast.removeClass('text-bg-success text-bg-warning').addClass('text-bg-danger');
      } else {
        toastIcon.removeClass().addClass('fas fa-info-circle me-2 text-info');
        toast.removeClass('text-bg-success text-bg-danger').addClass('text-bg-info');
      }
      
      toastTitle.text(title);
      toastMessage.text(message);
      
      const bsToast = new bootstrap.Toast(toast[0]);
      bsToast.show();
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return String(text).replace(/[&<>"']/g, m => map[m]);
    }
  </script>
</body>
</html>

